# FastFoodSystem - MVP - FASE 01
Projeto acad√™mico desenvolvido para a disciplina de Arquitetura de Software (FIAP - P√≥s-gradua√ß√£o), com foco em modelagem baseada em DDD, Event Storming e arquitetura hexagonal.

## Vis√£o Geral

Este sistema simula o fluxo completo de atendimento de um restaurante fast food, desde a identifica√ß√£o do cliente, montagem do pedido, pagamento, acompanhamento da prepara√ß√£o, at√© a entrega.

---

## Objetivos da Fase 01

- [x] Aplicar **Event Storming completo** com base nos conceitos da aula 6.
- [x] Utilizar **linguagem ub√≠qua**.
- [x] Implementar arquitetura **Clean Architeture**.
- [x] Criar as **APIs obrigat√≥rias**.
- [x] Disponibilizar o Swagger para testes.
- [x] Disponibilizar o sistema com **Kubernetes** (KIND + Docker).
- [x] Implementar **auto-scaling** com HPA (Horizontal Pod Autoscaler).
- [x] Configurar **Ingress** para acesso externo com dom√≠nio personalizado.

---

## Fluxos Modelados

### 1. Realiza√ß√£o do pedido e pagamento
- Identifica√ß√£o (CPF, cadastro ou an√¥nimo)
- Montagem de combo (lanche, acompanhamento, bebida, sobremesa)
- Envio do pedido via fake checkout
- Pagamento via QRCode (Mercado Pago - mock)

### 2. Prepara√ß√£o e entrega do pedido
- Pedido √© enviado √† cozinha
- Cliente acompanha status: Recebido ‚Üí Em prepara√ß√£o ‚Üí Pronto ‚Üí Finalizado
- Cliente retira o pedido
- Sistema registra a finaliza√ß√£o

---

## Arquitetura

- **Monolito modular**
- **Clean Architeture**
- **Domain-Driven Design (DDD)**
  - Event Storming
  - Entidades, Objetos de Valor, Agregados
  - Linguagem Ub√≠qua

> **üéØ Event Storming:** Acesse nossa modelagem completa do dom√≠nio em [FastFood Event Storming](https://app.eraser.io/workspace/zO0ZqV5uHMeMpAL2bUdc)

**Diagrama de Infraestrutura do projeto (Junto ao Event Storm, canto inferior direito), considerando um Cluster Kubernetes:**

https://app.eraser.io/workspace/zO0ZqV5uHMeMpAL2bUdc

### **Estrutura de Camadas:**

#### **Camadas do Projeto**

- **API (`Soat.Eleven.FastFood.Api/`)**  
   Camada de apresenta√ß√£o, respons√°vel pelos endpoints REST, autentica√ß√£o/autoriza√ß√£o, middlewares e configura√ß√£o da Web API. Borda da aplica√ß√£o.

- **Application (`Soat.Eleven.FastFood.Application/`)**  
   Implementa os controllers da Clean Architeture,faz a ponte entre a API e o core.

- **Core/Domain (`Soat.Eleven.FastFood.Core/`)**  
   N√∫cleo da aplica√ß√£o,contendo Use Cases,Entidade,VOs, Enums, Interfaces de Gateways, Data Sources, Services

- **Infraestrutura (`Soat.Eleven.FastFood.Infra/`)**  
   Implementa√ß√£o concreta dos reposit√≥rios, gateways externos, persist√™ncia de dados (Entity Framework), integra√ß√µes e configura√ß√µes espec√≠ficas de infraestrutura.

- **Testes (`Soat.Eleven.FastFood.Tests/`)**  
   Projeto dedicado a testes unit√°rios e de integra√ß√£o das principais camadas.

> A estrutura segue os princ√≠pios de Clean Architecture, promovendo separa√ß√£o de responsabilidades, testabilidade e flexibilidade para evolu√ß√£o do sistema.

### **Fluxo da Arquitetura Hexagonal:**
```
API Rest ‚Üí Controlles ‚Üí Core (Business Logic) ‚Üí Infrastructure (Driven Adapters)
```
---

## Tecnologias

- [.NET 8](https://dotnet.microsoft.com/en-us/)
- C#
- ASP.NET Core Web API
- Entity Framework Core
- Swagger (Swashbuckle)
- **Kubernetes** (KIND - Kubernetes in Docker)
- **Docker** + **Docker Compose**
- **NGINX Ingress Controller**
- **PostgreSQL** (Banco de Dados)
- **Metrics Server** + **HPA** (Auto-scaling)
- **Persistent Volumes** (Armazenamento)

---

## Infraestrutura Kubernetes

### Componentes do Cluster

O projeto roda em um cluster Kubernetes local usando **KIND** com os seguintes componentes:

#### **üì¶ Namespace e Configura√ß√µes**
- **`fastfood-namespace.yaml`** - Isola recursos da aplica√ß√£o
- **`config-map.yaml`** - Vari√°veis de ambiente n√£o-sens√≠veis
- **`secret.yaml`** - Credenciais do banco (usu√°rio/senha)

#### **üóÑÔ∏è Banco de Dados**
- **`db.yaml`** - Deploy do PostgreSQL
- **`db-service.yaml`** - Servi√ßo que exp√µe o banco
- **`db-pvc.yaml`** - Volume persistente para dados

#### **üîÑ Migrations**
- **`migrator-job.yaml`** - Job que executa Entity Framework migrations

#### **üöÄ Aplica√ß√£o**
- **`fastfood.yaml`** - Deploy da API .NET
- **`fastfood-service.yaml`** - Servi√ßo interno (ClusterIP)

#### **üåê Acesso Externo**
- **`fastfood-ingress-80.yaml`** - NGINX Ingress Controller
- **`fastfood-ingress.yaml`** - Regras de roteamento HTTP

#### **üìà Auto-scaling**
- **`metrics-server-kind.yaml`** - Coleta m√©tricas de CPU/mem√≥ria
- **`fastfood-hpa.yaml`** - Auto-scaling baseado em m√©tricas

#### **‚öôÔ∏è Configura√ß√£o KIND**
- **`kind-config.yaml`** - Cluster local com port mapping

### Arquitetura da solu√ß√£o rodando dentro do AKS
```
Localhost(Client) (fastfood:80/443)
   ‚îÇ
   ‚ñº
+-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    
| NGINX Ingress     |‚îÄ‚îÄ‚îÄ‚ñ∂| FastFood Service  |‚îÄ‚îÄ‚îÄ‚ñ∂| FastFood Pod(s)   |‚îÄ‚îÄ‚îÄ‚ñ∂| DB Service        |‚îÄ‚îÄ‚îÄ‚ñ∂| PostgreSQL Pod    |‚îÄ‚îÄ‚îÄ‚ñ∂| Persistent Volume 
+-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    
                             ‚îÇ
                             ‚ñº
                    +-------------------+
                    |      HPA          |
                    | (Auto-scaling)    |
                    +-------------------+
```
### Arquitetura de recursos
```
+-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+
| KIND Cluster      | -> | Namespace         | -> | ConfigMap/Secret  | -> | PostgreSQL Deploy | -> | DB Service        | -> | Migrator Job      | -> | FastFood Deploy   | -> | Metrics Server    |
+-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+    +-------------------+

```

## APIs Dispon√≠veis

### Autentica√ß√£o
| Rota                                | M√©todo | Descri√ß√£o                               |
|-------------------------------------|--------|-----------------------------------------|
| `/api/Auth`                         | POST   | Login com usu√°rio e senha               |
| `/api/Atendimento/token/anonimo`    | GET    | Token an√¥nimo (sem auth)                |
| `/api/Atendimento/token/porCpf/{cpf}` | GET  | Token por CPF (sem auth)                |

### Usu√°rios/Clientes
| Rota                                | M√©todo | Descri√ß√£o                               |
|-------------------------------------|--------|-----------------------------------------|
| `/api/Usuario/Cliente`              | POST   | Cadastro de cliente                     |
| `/api/Usuario/Cliente`              | PUT    | Atualizar cliente                       |
| `/api/Usuario/Cliente/PorCpf/{cpf}` | GET    | Identifica√ß√£o via CPF                   |
| `/api/Usuario/Administrador`        | POST   | Criar administrador                     |
| `/api/Usuario/Administrador`        | PUT    | Atualizar administrador                 |
| `/api/Usuario/Password`             | PUT    | Alterar senha                           |

### Categorias
| Rota                                | M√©todo | Descri√ß√£o                               |
|-------------------------------------|--------|-----------------------------------------|
| `/api/Categoria`                    | GET    | Listar categorias                       |
| `/api/Categoria/{id}`               | GET    | Obter categoria por ID                  |
| `/api/Categoria`                    | POST   | Criar nova categoria                    |
| `/api/Categoria/{id}`               | PUT    | Editar categoria                        |
| `/api/Categoria/{id}`               | DELETE | Desativar categoria                     |
| `/api/Categoria/{id}/reativar`      | POST   | Reativar categoria                      |

### Produtos
| Rota                                | M√©todo | Descri√ß√£o                               |
|-------------------------------------|--------|-----------------------------------------|
| `/api/Produto`                      | GET    | Listar produtos                         |
| `/api/Produto/{id}`                 | GET    | Obter produto por ID                    |
| `/api/Produto`                      | POST   | Criar novo produto                      |
| `/api/Produto/{id}`                 | PUT    | Editar produto                          |
| `/api/Produto/{id}`                 | DELETE | Desativar produto                       |
| `/api/Produto/{id}/reativar`        | POST   | Reativar produto                        |
| `/api/Produto/{id}/imagem`          | POST   | Upload de imagem                        |
| `/api/Produto/{id}/imagem`          | DELETE | Remover imagem                          |

### Pedidos
| Rota                                      | M√©todo | Descri√ß√£o                               |
|-------------------------------------------|--------|-----------------------------------------|
| `/api/Pedido`                             | POST   | Criar pedido                            |
| `/api/Pedido`                             | GET    | Listar pedidos (admin)                  |
| `/api/Pedido/{id}`                        | GET    | Obter pedido por ID                     |
| `/api/Pedido/{id}`                        | PUT    | Atualizar pedido                        |
| `/api/Pedido/{id}/pagar`                  | POST   | Processar pagamento                     |
| `/api/Pedido/{id}/iniciar-preparacao`     | POST   | Iniciar prepara√ß√£o (admin)              |
| `/api/Pedido/{id}/finalizar-preparacao`   | POST   | Finalizar prepara√ß√£o (admin)            |
| `/api/Pedido/{id}/finalizar`              | POST   | Finalizar pedido (admin)                |
| `/api/Pedido/{id}/cancelar`               | POST   | Cancelar pedido                         |

### Pagamento
| Rota                                      | M√©todo | Descri√ß√£o                               |
|-------------------------------------------|--------|-----------------------------------------|
| `/api/StatusPagamento`                             | GET    | Consulta Status do Pagamento   |

### Webhook
| Rota                                      | M√©todo | Descri√ß√£o                               |
|-------------------------------------------|--------|-----------------------------------------|
| `/Webhook/Pagamento/MercadoPago`          | Post    | Webhook para confirma√ß√£o de pagamento  |



> **Swagger dispon√≠vel em:** `http://fastfood/swagger` (ap√≥s configurar hosts)

---

## Deploy e Execu√ß√£o (KIND)

[Veja o arquivo`/manifesto/README.md`](manifesto/README.md)


## Arquivos e Estrutura do Projeto

### **üéØ Estrutura Geral**
```
üìÅ postech/
‚îú‚îÄ‚îÄ üìÅ src/                          # C√≥digo-fonte .NET
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Soat.Eleven.FastFood.sln     # Solution principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Soat.Eleven.FastFood.Api/    # Camada Web API 
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Soat.Eleven.FastFood.Application/ # Casos de Uso (Application)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ Soat.Eleven.FastFood.Core/   # Entidades e Regras (Domain)
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ Soat.Eleven.FastFood.Infra/  # Infraestrutura (Driven Adapters)
‚îú‚îÄ‚îÄ üìÅ manifesto/                    # Manifests Kubernetes
‚îú‚îÄ‚îÄ üìÅ docs/                         # Documenta√ß√£o
‚îú‚îÄ‚îÄ üìÅ Soat.Eleven.FastFood.Tests/   # Testes unit√°rios
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml           # Orquestra√ß√£o Docker Compose
‚îú‚îÄ‚îÄ üìÑ Dockerfile                   # Build da aplica√ß√£o
‚îî‚îÄ‚îÄ üìÑ README.md                    # Este arquivo
```

#### **Camadas Detalhadas:**

1. **Domain (Core)** - `Soat.Eleven.FastFood.Core/`
   - **Entities:** Cliente, Produto, Pedido, Categoria
   - **Value Objects:** CPF, Email, Preco
   - **Enums:** StatusPedido, StatusPagamento, TipoPagamento
   - **Ports (Interfaces):** Contratos para reposit√≥rios e gateways
   - **Business Rules:** Regras de neg√≥cio puras

2. **Application** - `Soat.Eleven.FastFood.Application/`
   - **Controllers:** Orquestra√ß√£o dos casos de uso
   - **UseCases:** L√≥gica de aplica√ß√£o espec√≠fica
   - **DTOs:** Objetos de transfer√™ncia de dados
   - **Presenters:** Formata√ß√£o de dados para apresenta√ß√£o

3. **Adapters** - `Soat.Eleven.FastFood.Api/` + `Soat.Eleven.FastFood.Infra/`
   - **WebApi:** Endpoints REST, middleware, configura√ß√µes
   - **Infrastructure:** Reposit√≥rios, gateways externos, persistence
   - **Data Sources:** Implementa√ß√µes concretas dos ports

### **üóÇÔ∏è Kubernetes Manifests (`manifesto/`)**

| Arquivo | Fun√ß√£o | Descri√ß√£o |
|---------|--------|-----------|
| `fastfood-namespace.yaml` | **Namespace** | Isolamento l√≥gico do ambiente |
| `secret.yaml` |  **Secrets** | Credenciais sens√≠veis (passwords, keys) |
| `config-map.yaml` |  **ConfigMap** | Configura√ß√µes n√£o-sens√≠veis da aplica√ß√£o |
| `db-pvc.yaml` |  **PersistentVolume** | Armazenamento persistente do PostgreSQL |
| `db.yaml` |  **Database** | Deploy do PostgreSQL com volumes |
| `db-service.yaml` |  **DB Service** | Exposi√ß√£o interna do banco |
| `migrator-job.yaml` |  **Job** | Execu√ß√£o √∫nica das migra√ß√µes EF Core |
| `deploy.yaml` |  **Deployment** | Deploy da aplica√ß√£o .NET |
| `fastfood-service.yaml` |  **App Service** | Exposi√ß√£o interna da aplica√ß√£o |
| `fastfood-ingress.yaml` | **Ingress (443)** | Acesso externo HTTPS |
| `fastfood-ingress-80.yaml` | **Ingress (80)** | Acesso externo HTTP |
| `metrics-server-kind.yaml` | **Metrics Server** | Coleta de m√©tricas para HPA |
| `fastfood-hpa.yaml` | **HPA** | Auto-scaling baseado em CPU |
| `kind-config.yaml` | **KIND Config** | Configura√ß√£o do cluster local |

## Licen√ßa

Este projeto √© desenvolvido para fins educacionais como parte do curso de Arquitetura de Software da FIAP/Alura.

### Integrantes do Grupo:
- Adriano Torini
- Andre Luiz
- Dhyogo Americo
- Filipe Braga
- Kauan Kajitani
